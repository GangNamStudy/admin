<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin=""/>
    <link
            rel="stylesheet"
            as="style"
            onload="this.rel='stylesheet'"
            href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />

    <title>Stitch Design</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,"/>

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>
<body>
<div class="relative flex size-full min-h-screen flex-col bg-gray-50 group/design-root overflow-x-hidden"
     style='font-family: Inter, "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">
        <div class="gap-1 px-6 flex flex-1 justify-center py-5">
            <div class="layout-content-container flex flex-col w-80">
                <div class="flex h-full min-h-[700px] flex-col justify-between bg-gray-50 p-4">
                    <div class="flex flex-col gap-4">
                        <h1 class="text-[#0d141c] text-base font-medium leading-normal">Ï£ºÏ∞®Ïû• Í¥ÄÎ¶¨</h1>
                        <div class="flex flex-col gap-2">
                            <a href="/">
                                <button class="flex items-center gap-3 px-3 py-2">
                                    <div class="text-[#0d141c]" data-icon="MagnifyingGlass" data-size="24px"
                                         data-weight="fill">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px"
                                             fill="currentColor" viewBox="0 0 256 256">
                                            <path
                                                    d="M168,112a56,56,0,1,1-56-56A56,56,0,0,1,168,112Zm61.66,117.66a8,8,0,0,1-11.32,0l-50.06-50.07a88,88,0,1,1,11.32-11.31l50.06,50.06A8,8,0,0,1,229.66,229.66ZM112,184a72,72,0,1,0-72-72A72.08,72.08,0,0,0,112,184Z"
                                            ></path>
                                        </svg>
                                    </div>
                                    <p class="text-[#0d141c] text-sm font-medium leading-normal">Í∞ÄÍ≤© Ï†ïÏ±Ö Ï°∞Ìöå</p>
                                </button>
                            </a>
                            <a href="/update-policy">
                                <button class="flex items-center gap-3 px-3 py-2">
                                    <div class="text-[#0d141c]" data-icon="PencilSimple" data-size="24px"
                                         data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px"
                                             fill="currentColor" viewBox="0 0 256 256">
                                            <path
                                                    d="M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z"
                                            ></path>
                                        </svg>
                                    </div>
                                    <p class="text-[#0d141c] text-sm font-medium leading-normal">Í∞ÄÍ≤© Ï†ïÏ±Ö ÏàòÏ†ï</p>
                                </button>
                            </a>
                            <a href="/parking-info">
                                <button class="flex items-center gap-3 px-3 py-2">
                                    <div class="text-[#0d141c]" data-icon="Car" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px"
                                             fill="currentColor" viewBox="0 0 256 256">
                                            <path
                                                    d="M240,112H229.2L201.42,49.5A16,16,0,0,0,186.8,40H69.2a16,16,0,0,0-14.62,9.5L26.8,112H16a8,8,0,0,0,0,16h8v80a16,16,0,0,0,16,16H64a16,16,0,0,0,16-16V192h96v16a16,16,0,0,0,16,16h24a16,16,0,0,0,16-16V128h8a8,8,0,0,0,0-16ZM69.2,56H186.8l24.89,56H44.31ZM64,208H40V192H64Zm128,0V192h24v16Zm24-32H40V128H216ZM56,152a8,8,0,0,1,8-8H80a8,8,0,0,1,0,16H64A8,8,0,0,1,56,152Zm112,0a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H176A8,8,0,0,1,168,152Z"
                                            ></path>
                                        </svg>
                                    </div>
                                    <p class="text-[#0d141c] text-sm font-medium leading-normal">Ï∞®Îüâ Í∏∞Î°ù Ï°∞Ìöå</p>
                                </button>
                            </a>
                            <a href="/revenue">
                                <button class="flex items-center gap-3 px-3 py-2 rounded-lg bg-[#e7edf4]">
                                    <div class="text-[#0d141c]" data-icon="CurrencyCircleDollar" data-size="24px"
                                         data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px"
                                             fill="currentColor" viewBox="0 0 256 256">
                                            <path
                                                    d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm40-68a28,28,0,0,1-28,28h-4v8a8,8,0,0,1-16,0v-8H104a8,8,0,0,1,0-16h36a12,12,0,0,0,0-24H116a28,28,0,0,1,0-56h4V72a8,8,0,0,1,16,0v8h16a8,8,0,0,1,0,16H116a12,12,0,0,0,0,24h24A28,28,0,0,1,168,148Z"
                                            ></path>
                                        </svg>
                                    </div>
                                    <p class="text-[#0d141c] text-sm font-medium leading-normal">Ïõî Î≥Ñ Ï¥ùÌï© Îß§Ï∂ú Ï°∞Ìöå</p>
                                </button>
                            </a>
                            <a href="/entrance">
                                <button class="flex items-center gap-3 px-3 py-2">
                                    <div class="text-[#0d141c]" data-icon="SignIn" data-size="24px"
                                         data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px"
                                             fill="currentColor" viewBox="0 0 256 256">
                                            <path
                                                    d="M141.66,133.66l-40,40a8,8,0,0,1-11.32-11.32L116.69,136H24a8,8,0,0,1,0-16h92.69L90.34,93.66a8,8,0,0,1,11.32-11.32l40,40A8,8,0,0,1,141.66,133.66ZM192,32H136a8,8,0,0,0,0,16h56V208H136a8,8,0,0,0,0,16h56a16,16,0,0,0,16-16V48A16,16,0,0,0,192,32Z"
                                            ></path>
                                        </svg>
                                    </div>
                                    <p class="text-[#0d141c] text-sm font-medium leading-normal">ÏûÖÏ∞® Ï≤òÎ¶¨</p>
                                </button>
                            </a>
                            <a href="/exit">
                                <button class="flex items-center gap-3 px-3 py-2">
                                    <div class="text-[#0d141c]" data-icon="SignOut" data-size="24px"
                                         data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px"
                                             fill="currentColor" viewBox="0 0 256 256">
                                            <path
                                                    d="M112,216a8,8,0,0,1-8,8H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32h56a8,8,0,0,1,0,16H48V208h56A8,8,0,0,1,112,216Zm109.66-93.66-40-40a8,8,0,0,0-11.32,11.32L196.69,120H104a8,8,0,0,0,0,16h92.69l-26.35,26.34a8,8,0,0,0,11.32,11.32l40-40A8,8,0,0,0,221.66,122.34Z"
                                            ></path>
                                        </svg>
                                    </div>
                                    <p class="text-[#0d141c] text-sm font-medium leading-normal">Ï∂úÏ∞® Ï≤òÎ¶¨</p>
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Î™®Îã¨ Ïä§ÌÉÄÏùº + JS ÎèôÏûë Ìè¨Ìï® -->
            <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
                <!-- Ìó§Îçî -->
                <div class="flex flex-wrap justify-between gap-3 p-4">
                    <p class="text-[#101518] tracking-light text-[32px] font-bold leading-tight min-w-72">ÏõîÎ≥Ñ Ï¥ùÌï© Îß§Ï∂ú
                        Ï°∞Ìöå</p>
                </div>

                <!-- Îã¨Î†• & Ïõî/ÎÖÑÎèÑ ÏÑ†ÌÉù -->
                <div class="flex flex-wrap items-center justify-center gap-6 p-4">
                    <div class="flex min-w-72 max-w-[336px] flex-1 flex-col gap-0.5">
                        <div class="flex items-center p-1 justify-between">
                            <!-- üìå Î™®Îã¨ Ìä∏Î¶¨Í±∞ Î≤ÑÌäº -->
                            <button id="searchDate"
                                    onclick="openModal()"
                                    class="text-[#101518] text-base font-bold leading-tight flex-1 text-center">
                                2024-07
                            </button>

                        </div>
                        <!-- Îã¨Î†• ÏöîÏùº Ìó§Îçî -->
                        <div id="calendar" class="bg-white"></div>

                        <!-- Ï¥ù Îß§Ï∂ú Ï†ïÎ≥¥ -->
                        <div class="flex flex-wrap gap-4 p-4">
                            <div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 bg-[#eaedf1]">
                                <p class="text-[#101518] text-base font-medium leading-normal">Ï¥ù Îß§Ï∂ú</p>
                                <p id="totalRevenue"
                                   class="text-[#101518] tracking-light text-2xl font-bold leading-tight">
                                    $12,500</p>
                            </div>
                        </div>
                    </div>
                    <!-- Î™®Îã¨ -->
                    <div id="modal"
                         class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
                        <div class="bg-white p-6 rounded-lg shadow-xl">
                            <h2 class="text-lg font-bold mb-4">ÎÖÑÎèÑÏôÄ ÏõîÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>

                            <!-- ÎÖÑÎèÑ ÏÑ†ÌÉù -->
                            <label for="year" class="block mb-2">ÎÖÑÎèÑ</label>
                            <select id="year" class="border p-2 rounded w-full mb-4">
                                <!-- JSÎ°ú ÏûêÎèô ÏÉùÏÑ± -->
                            </select>

                            <!-- Ïõî ÏÑ†ÌÉù -->
                            <label for="month" class="block mb-2">Ïõî</label>
                            <select id="month" class="border p-2 rounded w-full mb-4">
                                <option value="1">1Ïõî</option>
                                <option value="2">2Ïõî</option>
                                <option value="3">3Ïõî</option>
                                <option value="4">4Ïõî</option>
                                <option value="5">5Ïõî</option>
                                <option value="6">6Ïõî</option>
                                <option value="7">7Ïõî</option>
                                <option value="8">8Ïõî</option>
                                <option value="9">9Ïõî</option>
                                <option value="10">10Ïõî</option>
                                <option value="11">11Ïõî</option>
                                <option value="12">12Ïõî</option>
                            </select>
                            <!-- Î≤ÑÌäº -->
                            <div class="flex justify-end space-x-4 mt-4">
                                <button onclick="closeModal()" class="text-gray-500">Ï∑®ÏÜå</button>
                                <button onclick="applyDate()" class="bg-blue-500 text-white px-4 py-2 rounded">ÌôïÏù∏
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    const modal = document.getElementById("modal");
    const yearSelect = document.getElementById("year");
    const monthSelect = document.getElementById("month");
    const calendar = document.getElementById("calendar");

    function openModal() {
        modal.classList.remove("hidden");
    }

    function closeModal() {
        modal.classList.add("hidden");
    }

    function applyDate() {
        const year = parseInt(yearSelect.value);
        const month = parseInt(monthSelect.value);

        renderCalendar(year, month);
        closeModal();
    }

    function populateYearOptions() {
        const currentYear = new Date().getFullYear();
        for (let y = currentYear - 100; y <= currentYear; y++) {
            const option = document.createElement("option");
            option.value = y;
            option.text = y + "ÎÖÑ";
            yearSelect.appendChild(option);
        }

        yearSelect.value = currentYear;
        monthSelect.value = new Date().getMonth() + 1;
    }

    async function renderCalendar(year, month) {
        const firstDay = new Date(year, month - 1, 1).getDay();
        const lastDate = new Date(year, month, 0).getDate();

        // 1. Îß§Ï∂ú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        const startDate = `${year}-${String(month).padStart(2, '0')}-01T00:00:00`;
        const endDate = `${year}-${String(month).padStart(2, '0')}-${String(lastDate).padStart(2, '0')}T23:59:59`;

        let revenueData = { totalAmount: 0, days: [] };
        try {
            const res = await fetch(`/api/admin/payment?startDate=${startDate}&endDate=${endDate}`);
            if (res.ok) {
                revenueData = await res.json();
            } else {
                console.warn("Îß§Ï∂ú Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
            }
        } catch (e) {
            console.error("API Ìò∏Ï∂ú Ïò§Î•ò:", e);
        }

        const dailyMap = {};
        revenueData.days.forEach(item => {
            dailyMap[item.date] = item.dayFee;
        });

        // 2. Ï∫òÎ¶∞Îçî Î†åÎçîÎßÅ
        document.querySelector("#searchDate").innerHTML = year + "-" + month + "Ïõî";
        let html = `<div class="grid grid-cols-7 gap-2 text-center">`;
        html += ["Ïùº", "Ïõî", "Ìôî", "Ïàò", "Î™©", "Í∏à", "ÌÜ†"].map(d =>
            `<div class="text-[#101518] text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">${d}</div>`
        ).join("");

        for (let i = 0; i < firstDay; i++) html += `<div></div>`;

        for (let day = 1; day <= lastDate; day++) {
            const fee = dailyMap[day] || 0;
            html += `
            <div class="h-12 w-full text-[#101518] text-sm font-medium leading-normal">
                ${day}<br/>
                <span class="text-xs text-gray-500">${fee.toLocaleString()}Ïõê</span>
            </div>
        `;
        }

        html += `</div>`;
        calendar.innerHTML = html;

        // 3. Ï¥ù Îß§Ï∂ú ÌëúÏãú
        const totalDiv = document.getElementById("totalRevenue");
        if (totalDiv) {
            totalDiv.textContent = `Ï¥ù Îß§Ï∂ú: ${revenueData.totalAmount.toLocaleString()}Ïõê`;
        }
    }
    populateYearOptions();
    renderCalendar(new Date().getFullYear(), new Date().getMonth() + 1);
</script>
</html>
